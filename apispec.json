{
  "openapi": "3.0.3",
  "info": {
    "title": "Flask RESTful API Cafe 3awan",
    "description": "API untuk manajemen menu, keranjang (cart), dan pesanan (order) di Cafe 3awan.",
    "version": "1.0.1",
    "contact": {
      "name": "Akbar Maulana",
      "email": "zulfikarwxz22@gmail.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:9090/api/v1",
      "description": "Development server"
    },
    {
      "url": "https://api.server.test/v1",
      "description": "Production server"
    }
  ],
  "tags": [
    { "name": "menus", "description": "Manajemen daftar menu" },
    { "name": "carts", "description": "Keranjang pengguna" },
    { "name": "orders", "description": "Transaksi dan pesanan" }
  ],
  "paths": {
    "/menus": {
      "get": {
        "security": [{ "Auth": [] }],
        "tags": ["menus"],
        "summary": "Get all menus",
        "parameters": [
          { "$ref": "#/components/parameters/search" },
          { "$ref": "#/components/parameters/category_id" },
          { "$ref": "#/components/parameters/price_from" },
          { "$ref": "#/components/parameters/price_to" },
          { "$ref": "#/components/parameters/page" },
          { "$ref": "#/components/parameters/size" }
        ],
        "responses": {
          "200": {
            "description": "Success get all menus",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/menus_response" },
                "example": {
                  "message": "Success get menus",
                  "data": [
                    {
                      "menu_id": 1,
                      "name": "Kopi Latte",
                      "price": 25000,
                      "img_url": "/img/latte.png",
                      "category": "Coffe"
                    }
                  ],
                  "meta": {
                    "current_page": 1,
                    "per_page": 10,
                    "total_pages": 1,
                    "total_items": 1
                  }
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/cart": {
      "post": {
        "security": [{ "Auth": [] }],
        "tags": ["carts"],
        "summary": "Add menu to cart (creates or increments an item)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/create_cart_request" },
              "example": { "menu_id": 2 }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Menu added to cart successfully",
            "content": {
              "application/json": {
                "schema": { 
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "data": { 
                      "type": "object",
                      "properties": {
                        "menu_id": { "type": "integer", "minimum": 1 }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "409": { "$ref": "#/components/responses/Conflict" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "get": {
        "security": [{ "Auth": [] }],
        "tags": ["carts"],
        "summary": "Get all cart items",
        "parameters": [
          { "$ref": "#/components/parameters/search" },
          { "$ref": "#/components/parameters/page" },
          { "$ref": "#/components/parameters/size" }
        ],
        "responses": {
          "200": {
            "description": "Success get all cart items",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/carts_response" }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "delete": {
        "security": [{ "Auth": [] }],
        "tags": ["carts"],
        "summary": "Delete all menus in cart",
        "responses": {
          "204": {
            "description": "All menu deleted from cart",
            "content": {}
          },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/cart/menus/{menuId}": {
      "patch": {
        "security": [{ "Auth": [] }],
        "tags": ["carts"],
        "summary": "Update menu quantity in cart",
        "parameters": [{ "$ref": "#/components/parameters/menu_id" }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["qty"],
                "properties": { "qty": { "type": "integer", "minimum": 1 } }
              },
              "example": { "qty": 3 }
            }
          }
        },
        "responses": {
          "200": { "description": "Quantity updated successfully" },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "409": { "$ref": "#/components/responses/Conflict" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "delete": {
        "security": [{ "Auth": [] }],
        "tags": ["carts"],
        "summary": "Delete specific menu in cart",
        "parameters": [{ "$ref": "#/components/parameters/menu_id" }],
        "responses": {
          "204": { "description": "Menu deleted from cart", "content": {} },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/orders": {
      "post": {
        "security": [{ "Auth": [] }],
        "tags": ["orders"],
        "summary": "Create order from cart or provided details",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/create_order_request" },
              "example": { "customer_id": 1, "details": [{ "menu_id": 5, "qty": 1 }] }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Order created successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/order_response" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "409": { "$ref": "#/components/responses/Conflict" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      },
      "get": {
        "security": [{ "Auth": [] }],
        "tags": ["orders"],
        "summary": "Get all orders",
        "parameters": [
          { "$ref": "#/components/parameters/search" },
          { "$ref": "#/components/parameters/page" },
          { "$ref": "#/components/parameters/size" }
        ],
        "responses": {
          "200": {
            "description": "Success get all orders",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/orders_response" },
                "example": {
                  "message": "Success get orders",
                  "data": [
                    {
                      "order_id": 12,
                      "customer_name": "Akbar Maulana",
                      "status": "PAID",
                      "total": 50000,
                      "created_at": "2025-10-31T09:30:00Z"
                    }
                  ],
                  "meta": {
                    "current_page": 1,
                    "per_page": 10,
                    "total_pages": 1,
                    "total_items": 1
                  }
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    },
    "/orders/{orderId}": {
      "get": {
        "security": [{ "Auth": [] }],
        "tags": ["orders"],
        "summary": "Get detail of specific order",
        "parameters": [{ "$ref": "#/components/parameters/order_id" }],
        "responses": {
          "200": {
            "description": "Success get order detail",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/order_response" },
                "example": {
                  "message": "Success get order detail",
                  "data": {
                    "order_id": 12,
                    "customer_name": "Akbar Maulana",
                    "status": "PAID",
                    "total": 65000,
                    "created_at": "2025-10-31T09:30:00Z",
                    "details": [
                      {
                        "menu": {
                          "menu_id": 5,
                          "name": "Kopi Latte",
                          "category_id": 2,
                          "price": 25000,
                          "img_url": "/img/latte.png"
                        },
                        "menu_name": "Kopi Latte",
                        "qty": 2,
                        "snapshot_price": 25000
                      },
                      {
                        "menu": {
                          "menu_id": 7,
                          "name": "Croissant Coklat",
                          "category_id": 3,
                          "price": 15000,
                          "img_url": "/img/croissant.png"
                        },
                        "menu_name": "Croissant Coklat",
                        "qty": 1,
                        "snapshot_price": 15000
                      }
                    ]
                  }
                }

              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalServerError" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "Auth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-KEY"
      }
    },
    "parameters": {
      "search": {
        "name": "search",
        "in": "query",
        "schema": { "type": "string" },
        "example": "kopi"
      },
      "page": {
        "name": "page",
        "in": "query",
        "schema": { "type": "integer", "default": 1 },
        "description": "Halaman data"
      },
      "size": {
        "name": "size",
        "in": "query",
        "schema": { "type": "integer", "default": 10 },
        "description": "Jumlah data per halaman"
      },
      "price_from": {
        "name": "price_from",
        "in": "query",
        "schema": { "type": "integer" }
      },
      "price_to": {
        "name": "price_to",
        "in": "query",
        "schema": { "type": "integer" }
      },
      "category_id": {
        "name": "category_id",
        "in": "query",
        "schema": { "type": "integer" }
      },
      "menu_id": {
        "name": "menuId",
        "in": "path",
        "required": true,
        "schema": { "type": "integer" }
      },
      "order_id": {
        "name": "orderId",
        "in": "path",
        "required": true,
        "schema": { "type": "integer" },
        "description": "ID dari order yang ingin diambil"
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Invalid request body or parameters",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/error_response" }
          }
        }
      },
      "Conflict": {
        "description": "Validation error or duplicate data",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/error_response" }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/error_response" }
          }
        }
      },
      "InternalServerError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/error_response" }
          }
        }
      }
    },
    "schemas": {
      "error_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "errors": { "type": "array", "items": { "type": "string" } }
        }
      },
      "menus": {
        "type": "object",
        "properties": {
          "menu_id": { "type": "integer" },
          "name": { "type": "string" },
          "category": { "type": "string" },
          "price": { "type": "integer" },
          "img_url": { "type": "string" }
        }
      },
      "menus_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "data": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/menus" }
          },
          "meta": {
            "type": "object",
            "properties": {
              "current_page": { "type": "integer" },
              "per_page": { "type": "integer" },
              "total_pages": { "type": "integer" },
              "total_items": { "type": "integer" }
            }
          }
        }
      },
      "cart_item": {
        "type": "object",
        "properties": {
          "menu": { "$ref": "#/components/schemas/menus" },
          "qty": { "type": "integer", "minimum": 1 }
        },
        "required": ["menu", "qty"]
      },
      "cart_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "data": { 
            "type": "object",
            "properties": {
              "menu_id": { "type": "integer", "minimum": 1 }
            }
          }
        }
      },
      "carts_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "data": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/cart_item" }
          },
          "meta": {
            "type": "object",
            "properties": {
              "current_page": { "type": "integer" },
              "per_page": { "type": "integer" },
              "total_pages": { "type": "integer" },
              "total_items": { "type": "integer" }
            }
          }
        }
      },
      "order_item": {
        "type": "object",
        "properties": {
          "menu": { "$ref": "#/components/schemas/menus" },
          "menu_name": {
            "type": "string",
            "description": "Nama menu saat order dibuat (snapshot)"
          },
          "qty": { "type": "integer", "minimum": 1 },
          "snapshot_price": {
            "type": "integer",
            "description": "Harga menu saat order dibuat (price snapshot)"
          }
        },
        "required": ["menu", "menu_name", "qty", "snapshot_price"]
      },
      "order": {
        "type": "object",
        "required": [
          "order_id",
          "customer_name",
          "status",
          "details",
          "total",
          "created_at"
        ],
        "properties": {
          "order_id": { "type": "integer" },
          "customer_name": {
            "type": "string",
            "description": "Nama customer saat transaksi dibuat (snapshot dari user)"
          },
          "status": {
            "type": "string",
            "enum": ["PENDING", "PAID", "CANCELLED"]
          },
          "details": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/order_item" }
          },
          "total": { "type": "integer" },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "order_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "data": { "$ref": "#/components/schemas/order" }
        }
      },
      "orders_response": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "data": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/order" }
          },
          "meta": {
            "type": "object",
            "properties": {
              "current_page": { "type": "integer" },
              "per_page": { "type": "integer" },
              "total_pages": { "type": "integer" },
              "total_items": { "type": "integer" }
            }
          }
        }
      },
      "create_cart_request": {
        "type": "object",
        "required": ["menu_id"],
        "properties": {
          "menu_id": { "type": "integer" }
        }
      },
      "create_order_request": {
        "type": "object",
        "required": ["details"],
        "properties": {
          "customer_id": {
            "type": "string"
          },
          "details": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["menu_id", "qty"],
              "properties": {
                "menu_id": { "type": "integer" },
                "qty": { "type": "integer", "minimum": 1 }
              }
            }
          }
        }
      }
    }
  }
}
